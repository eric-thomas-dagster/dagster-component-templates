{
  "type": "dagster_component_templates.FunnelAnalysisComponent",
  "name": "Funnel Analysis",
  "category": "cdp",
  "description": "Track conversion rates through multi-step user journeys. Analyzes drop-off rates and conversion optimization opportunities.",
  "version": "1.0.0",
  "author": "Dagster Community",
  "x-dagster-io": {
    "inputs": {
      "type": "dataframe",
      "required": true,
      "description": "Event/session data with user_id, event_name, timestamp",
      "expected_columns": [
        {
          "name": "user_id",
          "type": "string",
          "required": true,
          "alternatives": ["customer_id", "userId", "customerId", "visitor_id", "session_id"]
        },
        {
          "name": "event_name",
          "type": "string",
          "required": true,
          "alternatives": ["event", "event_type", "action", "page_path"]
        },
        {
          "name": "timestamp",
          "type": "datetime",
          "required": true,
          "alternatives": ["event_time", "created_at", "date", "time"]
        }
      ],
      "compatible_upstream": [
        "google_analytics_4_ingestion",
        "matomo_ingestion",
        "product_analytics_standardizer",
        "event_data_standardizer"
      ]
    },
    "outputs": {
      "type": "dataframe",
      "description": "Funnel metrics with conversion rates, drop-offs, and time between steps",
      "columns": [
        {"name": "step_number", "type": "number"},
        {"name": "step_name", "type": "string"},
        {"name": "users_entered", "type": "number"},
        {"name": "conversion_rate_overall", "type": "number"},
        {"name": "conversion_rate_from_previous", "type": "number"},
        {"name": "drop_off_rate", "type": "number"},
        {"name": "avg_time_to_next_hours", "type": "number", "optional": true}
      ]
    },
    "supports_partitions": false
  },
  "attributes": {
    "asset_name": {
      "type": "string",
      "required": true,
      "label": "Asset Name",
      "description": "Name of the funnel analysis asset",
      "placeholder": "checkout_funnel"
    },
    "source_asset": {
      "type": "string",
      "required": false,
      "label": "Source Asset",
      "description": "Source asset with event/session data (set via lineage)",
      "placeholder": "user_events"
    },
    "funnel_steps": {
      "type": "string",
      "required": true,
      "label": "Funnel Steps",
      "description": "Comma-separated ordered funnel steps",
      "placeholder": "Landing,Product View,Add to Cart,Checkout,Purchase"
    },
    "conversion_window_hours": {
      "type": "number",
      "required": false,
      "label": "Conversion Window Hours",
      "description": "Maximum hours allowed between funnel steps",
      "default": 24,
      "min": 1,
      "max": 720
    },
    "require_sequential": {
      "type": "boolean",
      "required": false,
      "label": "Require Sequential",
      "description": "Require steps to occur in exact order (no skipping)",
      "default": true
    },
    "allow_skips": {
      "type": "boolean",
      "required": false,
      "label": "Allow Skips",
      "description": "Allow users to skip intermediate steps",
      "default": false
    },
    "user_id_field": {
      "type": "string",
      "required": false,
      "label": "User ID Field",
      "description": "User ID column name (auto-detected if not specified)",
      "placeholder": "user_id"
    },
    "event_name_field": {
      "type": "string",
      "required": false,
      "label": "Event Name Field",
      "description": "Event name column (auto-detected if not specified)",
      "placeholder": "event_name"
    },
    "timestamp_field": {
      "type": "string",
      "required": false,
      "label": "Timestamp Field",
      "description": "Timestamp column (auto-detected if not specified)",
      "placeholder": "timestamp"
    },
    "description": {
      "type": "string",
      "required": false,
      "label": "Description",
      "description": "Asset description",
      "placeholder": "Funnel conversion analysis"
    },
    "group_name": {
      "type": "string",
      "required": false,
      "label": "Group Name",
      "description": "Asset group for organization",
      "default": "product_analytics",
      "placeholder": "product_analytics"
    },
    "include_sample_metadata": {
      "type": "boolean",
      "required": false,
      "label": "Include Sample Metadata",
      "description": "Include data preview in metadata",
      "default": true
    }
  },
  "dependencies": {
    "pip": ["pandas>=1.5.0", "numpy>=1.24.0"]
  },
  "tags": ["cdp", "funnel", "conversion", "product-analytics", "optimization"],
  "icon": "GitBranch"
}
